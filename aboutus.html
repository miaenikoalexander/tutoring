<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
 <title>Psyche - Advanced AI Model</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <script>
 tailwind.config = {
 theme: {
 extend: {
 colors: {
 red: {
 50: '#fff1f2',
 100: '#ffe4e6',
 200: '#fecdd3',
 300: '#fda4af',
 400: '#fb7185',
 500: '#f43f5e',
 600: '#e11d48',
 700: '#be123c',
 800: '#9f1239',
 900: '#881337',
 950: '#4c0519',
 // Custom evil colors
 1000: '#2b0505', 
 1100: '#1a0202',
 },
 },
 animation: {
 'spin-slow': 'spin 3s linear infinite',
 'fade-out-up': 'fadeOutUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards',
 'logo-enter': 'logoEnter 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards',
 'content-fade-in': 'contentFadeIn 1s ease-out forwards',
 },
 keyframes: {
 fadeOutUp: {
 '0%': { opacity: '1', transform: 'scale(1)' },
 '100%': { opacity: '0', transform: 'scale(0.98) translateY(-5px)', visibility: 'hidden' },
 },
 logoEnter: {
 '0%': { opacity: '0', transform: 'scale(0.8) translateY(20px)' },
 '100%': { opacity: '1', transform: 'scale(1) translateY(0)' },
 },
 contentFadeIn: {
 '0%': { opacity: '0', transform: 'translateY(10px)' },
 '100%': { opacity: '1', transform: 'translateY(0)' },
 }
 }
 }
 }
 }
 </script>
 <style>
 @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap');

 body {
 font-family: 'Inter', sans-serif;
 background-color: #fff1f2; /* Red 50 */
 color: #881337; /* Red 900 */
 transition: background-color 1.5s ease, color 1.5s ease;
 /* Prevent bounce scrolling on mobile */
 overscroll-behavior: none;
 }

 .scrollbar-hide::-webkit-scrollbar {
 display: none;
 }
 .scrollbar-hide {
 -ms-overflow-style: none;
 scrollbar-width: none;
 }

 /* Typing Cursor Animation */
 .typing-cursor::after {
 content: 'â–‹';
 display: inline-block;
 animation: blink 1s step-start infinite;
 color: #e11d48; /* Red 600 */
 margin-left: 2px;
 }

 @keyframes blink {
 50% { opacity: 0; }
 }

 /* Pulse animation for the listening microphone in text mode */
 @keyframes pulse-ring {
 0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.7); }
 70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(225, 29, 72, 0); }
 100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(225, 29, 72, 0); }
 }
 .listening {
 animation: pulse-ring 2s infinite;
 color: #e11d48 !important; /* Red 600 */
 }

 .markdown-body {
 line-height: 1.6;
 color: inherit;
 }
 .markdown-body code {
 font-family: 'JetBrains Mono', monospace;
 background: #ffe4e6; /* Red 100 */
 color: #be123c; /* Red 700 */
 padding: 0.2em 0.4em;
 border-radius: 4px;
 font-size: 0.9em;
 }

 /* --- Voice Mode Orb Animations (Modern Flat Style) --- */
 .voice-orb {
 width: 100px;
 height: 100px;
 border-radius: 50%;
 background: #ffffff;
 display: flex;
 align-items: center;
 justify-content: center;
 position: relative;
 transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
 z-index: 10;
 box-shadow: 0 4px 20px rgba(225, 29, 72, 0.1);
 }

 /* Default Icon Color (Red) */
 .voice-orb svg {
 width: 40px;
 height: 40px;
 color: #e11d48;
 transition: color 0.3s ease;
 z-index: 20;
 }

 /* --- STATE: LISTENING (WAIT) --- */
 /* Calm, subtle breathing shadow */
 .voice-orb.state-listening {
 animation: breathe-shadow 4s infinite ease-in-out;
 transform: scale(1);
 }
 @keyframes breathe-shadow {
 0% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.05); transform: scale(1); }
 50% { box-shadow: 0 0 0 20px rgba(225, 29, 72, 0.05); transform: scale(1.02); }
 100% { box-shadow: 0 0 0 0 rgba(225, 29, 72, 0.05); transform: scale(1); }
 }

 /* --- STATE: THINKING --- */
 /* Spinning border ring */
 .voice-orb.state-thinking::after {
 content: '';
 position: absolute;
 inset: -6px; /* Outside the circle */
 border-radius: 50%;
 border: 3px solid transparent;
 border-top-color: #e11d48;
 border-right-color: #fda4af;
 animation: spin 1s linear infinite;
 }
 @keyframes spin {
 from { transform: rotate(0deg); }
 to { transform: rotate(360deg); }
 }

 /* --- STATE: SPEAKING --- */
 /* Filling with color and pulsing */
 .voice-orb.state-speaking {
 background: #e11d48; /* Fill with red */
 animation: pulse-speak 0.8s infinite alternate ease-in-out;
 box-shadow: 0 10px 40px rgba(225, 29, 72, 0.4);
 }
 .voice-orb.state-speaking svg {
 color: #ffffff; /* White icon when filled */
 }
 
 @keyframes pulse-speak {
 0% { transform: scale(1); }
 100% { transform: scale(1.15); }
 }

 /* --- DARK RED THEME OVERRIDES (EVIL MODE) --- */
 
 /* Activate overlay for smooth background transition */
 body.theme-dark #dark-mode-bg {
 opacity: 1;
 }

 body.theme-dark {
 /* Background handled by overlay for smoothness */
 color: #fecdd3; /* Red 200 */
 }
 
 /* Header */
 body.theme-dark .header-theme {
 background-color: rgba(26, 2, 2, 0.8) !important;
 backdrop-filter: blur(12px);
 border-color: #450a0a !important;
 }
 body.theme-dark .header-text-theme {
 color: #fecdd3 !important;
 text-shadow: 0 0 10px rgba(225, 29, 72, 0.3);
 }
 body.theme-dark .logo-theme {
 color: #ef4444 !important;
 filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5));
 }
 body.theme-dark .header-btn-theme {
 color: #9f1239 !important;
 }
 body.theme-dark .header-btn-theme:hover {
 background-color: #450a0a !important;
 color: #fecdd3 !important;
 }
 
 /* Model Selector */
 body.theme-dark .model-selector-container {
 background-color: #2b0505 !important;
 border-color: #450a0a !important;
 }
 body.theme-dark .model-selector-active {
 background-color: #450a0a !important;
 color: #fecdd3 !important;
 border-color: #7f1d1d !important;
 box-shadow: 0 0 10px rgba(127, 29, 29, 0.3);
 }
 body.theme-dark .model-selector-inactive {
 color: #7f1d1d !important;
 }

 /* Chat Bubbles */
 body.theme-dark .user-bubble-theme {
 background: linear-gradient(135deg, #450a0a, #2b0505) !important;
 color: #ffe4e6 !important;
 border: 1px solid #7f1d1d !important;
 box-shadow: 0 2px 10px rgba(0,0,0,0.3) !important;
 }
 body.theme-dark .ai-icon-bg {
 background: linear-gradient(135deg, #991b1b, #7f1d1d) !important;
 box-shadow: 0 0 15px rgba(153, 27, 27, 0.4) !important;
 }
 body.theme-dark .ai-text-theme {
 color: #fda4af !important; /* Lighter pink/red for readability */
 text-shadow: 0 0 1px rgba(253, 164, 175, 0.3);
 }
 body.theme-dark .markdown-body code {
 background-color: #1a0202 !important;
 color: #fca5a5 !important;
 border: 1px solid #450a0a;
 }
 
 /* Empty State */
 body.theme-dark #empty-state div {
 background-color: rgba(43, 5, 5, 0.5) !important;
 border-color: #450a0a !important;
 box-shadow: 0 0 20px rgba(69, 10, 10, 0.3) !important;
 }

 /* Input Area - Dark Mode */
 body.theme-dark .bottom-gradient-theme {
 background: linear-gradient(to top, #1a0202 0%, rgba(26, 2, 2, 0.9) 60%, transparent 100%) !important;
 }
 body.theme-dark .input-container-theme {
 background-color: rgba(43, 5, 5, 0.8) !important;
 backdrop-filter: blur(10px);
 border: 1px solid #7f1d1d !important;
 box-shadow: 0 0 25px rgba(127, 29, 29, 0.2) !important;
 }
 body.theme-dark .input-container-theme:focus-within {
 border-color: #ef4444 !important;
 box-shadow: 0 0 30px rgba(239, 68, 68, 0.25) !important;
 }
 body.theme-dark #user-input {
 color: #ffe4e6 !important;
 }
 body.theme-dark #user-input::placeholder {
 color: #7f1d1d !important;
 }
 body.theme-dark #mic-btn {
 color: #991b1b !important;
 }
 body.theme-dark #mic-btn:hover {
 color: #fca5a5 !important;
 background-color: rgba(255,255,255,0.05);
 }
 body.theme-dark #send-btn {
 background-color: #991b1b !important;
 box-shadow: 0 0 10px rgba(153, 27, 27, 0.4);
 }
 body.theme-dark #send-btn:hover {
 background-color: #b91c1c !important;
 }
 body.theme-dark .disclaimer-text {
 color: #7f1d1d !important;
 }
 
 /* Voice Mode Overlay (Evil) */
 body.theme-dark #voice-mode-screen {
 background: radial-gradient(circle at center, #2b0505 0%, #000000 100%) !important;
 }
 body.theme-dark #voice-status {
 color: #fecdd3 !important;
 text-shadow: 0 0 10px rgba(225, 29, 72, 0.4);
 }
 body.theme-dark .voice-control-btn {
 background-color: #28050a !important;
 border-color: #7f1d1d !important;
 color: #fda4af !important;
 box-shadow: none !important;
 }
 body.theme-dark .voice-control-btn:hover {
 background-color: #7f1d1d !important;
 color: white !important;
 }
 
 /* Scrollbar for dark mode */
 body.theme-dark ::-webkit-scrollbar-thumb {
 background-color: #450a0a;
 }

 </style>
</head>
<body class="flex h-[100dvh] overflow-hidden text-red-900 bg-red-50">

 <!-- Dark Mode Background Overlay (Transitions smoothly for Evil Mode) -->
 <div id="dark-mode-bg" class="fixed inset-0 z-[-1] bg-gradient-to-b from-[#1a0202] to-[#2b0505] opacity-0 transition-opacity duration-[1500ms] pointer-events-none"></div>

 <!-- Splash Screen -->
 <div id="splash-screen" class="fixed inset-0 z-[100] bg-red-50 flex flex-col items-center justify-center pb-20"> 
 <div class="flex flex-col items-center animate-logo-enter">
 <!-- Matches Empty State Logo Box -->
 <div class="bg-white/60 backdrop-blur-sm p-6 rounded-2xl mb-6 shadow-lg shadow-red-100/50 border border-red-50">
 <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
 </div>
 
 <div class="w-32 h-1 bg-red-100 rounded-full overflow-hidden">
 <div id="loading-bar" class="h-full bg-red-600 w-0 rounded-full transition-all duration-[1500ms] ease-out"></div>
 </div>
 </div>
 </div>

 <!-- Main Chat Area -->
 <main class="flex-1 flex flex-col relative opacity-0">
 
 <!-- Unified Header -->
 <header class="header-theme h-16 flex items-center justify-between px-4 md:px-6 border-b border-red-100 bg-white/80 backdrop-blur-sm z-20 shadow-sm shadow-red-100/50 transition-colors duration-[1500ms]">
 <div class="flex items-center gap-2">
 <!-- Hexagon Logo Small -->
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="logo-theme text-red-600"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
 <span class="header-text-theme font-semibold text-red-900 text-lg tracking-tight">Psyche</span>
 </div>
 
 <!-- Model Selector -->
 <div class="model-selector-container hidden md:flex bg-red-50 rounded-lg p-1 border border-red-100 transition-colors duration-[1500ms]">
 <button class="model-selector-active px-3 py-1 bg-white text-red-700 text-xs font-semibold rounded shadow-sm shadow-red-100 border border-red-100 transition-colors">Psyche 4.0</button>
 <button class="model-selector-inactive px-3 py-1 text-red-400 text-xs font-medium hover:text-red-700 transition-colors">Psyche 3.5</button>
 </div>

 <div class="flex items-center gap-2">
 <!-- Voice Mode Trigger -->
 <button id="voice-toggle-btn" onclick="toggleVoiceMode()" class="header-btn-theme p-2 text-red-400 hover:text-red-700 hover:bg-red-100 rounded-full transition-colors" title="Enter Voice Mode">
 <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
 </button>

 <button onclick="window.location.reload()" class="header-btn-theme p-2 text-red-400 hover:text-red-700 hover:bg-red-100 rounded-full transition-colors" title="New Chat">
 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
 </button>
 <button onclick="toggleConfigModal()" class="header-btn-theme p-2 text-red-400 hover:text-red-700 hover:bg-red-100 rounded-full transition-colors" title="Settings">
 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
 </button>
 </div>
 </header>

 <!-- Chat Container -->
 <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-8 scrollbar-hide scroll-smooth">
 <!-- Initial Empty State -->
 <div id="empty-state" class="h-full flex flex-col items-center justify-center text-center opacity-100 transition-opacity duration-300 pb-20">
 <div class="bg-white/60 backdrop-blur-sm p-6 rounded-2xl mb-6 shadow-lg shadow-red-100/50 border border-red-50">
 <!-- Hexagon Logo Large -->
 <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
 </div>
 <h2 class="header-text-theme text-2xl font-bold text-red-900 mb-2">How can I help you today?</h2>
 <p class="header-text-theme text-red-400">Ask anything, I'm ready to assist.</p>
 </div>
 
 <!-- Messages will appear here -->
 <div id="messages-list" class="flex flex-col gap-8 max-w-3xl mx-auto pb-48"></div>
 </div>

 <!-- Input Area - Lifted Up & Pill Shaped (Google Style) -->
 <div class="bottom-gradient-theme w-full absolute bottom-0 bg-gradient-to-t from-red-50 via-red-50/90 to-transparent pt-8 pb-4 md:pb-16 px-4 transition-colors duration-[1500ms]">
 <div class="max-w-3xl mx-auto">
 <div class="input-container-theme relative flex items-end gap-3 bg-white border border-red-100 rounded-[2rem] px-5 py-3 shadow-2xl shadow-red-100/40 focus-within:border-red-400 focus-within:ring-4 focus-within:ring-red-50 transition-all transform hover:-translate-y-0.5 duration-300">
 
 <!-- Microphone / Dictation -->
 <button id="mic-btn" onclick="toggleDictation()" class="p-2 text-red-400 hover:text-red-600 hover:bg-red-50 transition-colors rounded-full mb-0.5" title="Use Voice">
 <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
 </button>

 <textarea 
 id="user-input" 
 rows="1" 
 class="w-full bg-transparent text-red-900 placeholder-red-300 focus:outline-none resize-none py-2.5 max-h-48 overflow-y-auto" 
 placeholder="Message Psyche..."
 oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'"
 onkeydown="handleEnter(event)"
 ></textarea>

 <button onclick="sendMessage()" class="p-2 bg-red-600 hover:bg-red-700 text-white rounded-full transition-colors mb-0.5 shadow-md shadow-red-200 disabled:opacity-50 disabled:cursor-not-allowed" id="send-btn">
 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
 </button>
 </div>
 <div class="disclaimer-text text-center text-xs text-red-400 mt-4 font-medium opacity-80">
 Psyche may produce inaccurate information about people, places, or facts.
 </div>
 </div>
 </div>

 </main>

 <!-- FULL SCREEN VOICE MODE OVERLAY -->
 <div id="voice-mode-screen" class="fixed inset-0 z-[100] hidden bg-red-50/95 backdrop-blur-md flex flex-col items-center justify-between py-6 transition-all duration-[1500ms]">
 
 <!-- Top Controls -->
 <div class="w-full px-6 flex justify-between items-center max-w-4xl">
 <button onclick="toggleVoiceMode()" class="voice-control-btn text-red-400 hover:text-red-700 transition-colors p-2 hover:bg-red-100 rounded-full">
 <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
 </button>
 <div class="w-10"></div> <!-- Spacer for balance -->
 </div>

 <!-- Central Visualization -->
 <div class="flex-1 flex flex-col items-center justify-center w-full relative">
 <div class="relative flex items-center justify-center">
 <!-- Main Orb -->
 <div id="main-orb" class="voice-orb state-listening flex items-center justify-center">
 <!-- Waveform Icon -->
 <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
 <path d="M12 3v18M8 7v10M4 11v2M16 7v10M20 11v2"></path>
 </svg>
 </div>
 </div>
 
 <div class="mt-16 text-center space-y-2 h-20">
 <h2 id="voice-status" class="text-3xl font-bold text-red-900 transition-all duration-300">Listening...</h2>
 </div>
 </div>

 <!-- Bottom Controls (Manual Icons + Dark Mode Toggle) -->
 <div class="flex items-center gap-6 pb-12 z-50">
 <!-- WAIT (Pause icon) -->
 <button onclick="setVoiceState('listening')" class="voice-control-btn p-4 bg-white border border-red-100 rounded-full shadow-md shadow-red-100/50 text-red-400 hover:text-red-700 hover:bg-red-50 transition-all active:scale-95" title="Wait">
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
 </button>
 <!-- THINK (Brain/Process icon) -->
 <button onclick="setVoiceState('thinking')" class="voice-control-btn p-4 bg-white border border-red-100 rounded-full shadow-md shadow-red-100/50 text-red-400 hover:text-red-700 hover:bg-red-50 transition-all active:scale-95" title="Think">
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"></path><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"></path></svg>
 </button>
 <!-- SPEAK (Waveform icon) -->
 <button onclick="setVoiceState('speaking')" class="voice-control-btn p-4 bg-white border border-red-100 rounded-full shadow-md shadow-red-100/50 text-red-400 hover:text-red-700 hover:bg-red-50 transition-all active:scale-95" title="Speak">
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18M8 7v10M4 11v2M16 7v10M20 11v2"></path></svg>
 </button>
 <!-- DARK MODE TOGGLE (Skull icon) -->
 <button onclick="toggleTheme()" class="voice-control-btn p-4 bg-white border border-red-100 rounded-full shadow-md shadow-red-100/50 text-red-400 hover:text-red-700 hover:bg-red-50 transition-all active:scale-95" title="Dark Mode">
 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18a6 6 0 0 1 6-6 6 6 0 0 1 6 6"></path><path d="M12 12V6"></path><path d="M12 2a4 4 0 0 0-3.3 6.3"></path><path d="M15.3 8.3A4 4 0 0 0 12 2"></path><circle cx="9" cy="18" r="1"></circle><circle cx="15" cy="18" r="1"></circle></svg>
 </button>
 </div>
 </div>


 <!-- Configuration Modal -->
 <div id="config-modal" class="fixed inset-0 z-50 hidden bg-red-900/20 backdrop-blur-sm flex items-center justify-center p-4">
 <div class="bg-white border border-red-100 rounded-2xl w-full max-w-md p-6 shadow-2xl shadow-red-100/50">
 <div class="flex justify-between items-center mb-6">
 <h3 class="text-lg font-bold text-red-900">Fake AI Configuration</h3>
 <button onclick="toggleConfigModal()" class="text-red-400 hover:text-red-700 bg-red-50 p-1 rounded-full transition-colors">
 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
 </button>
 </div>
 
 <p class="text-sm text-red-500 mb-4 leading-relaxed">
 Set what the AI will say regardless of what is typed. Leave blank for generic techno-babble.
 </p>

 <label class="block text-xs font-bold text-red-400 mb-2 uppercase tracking-wide">Target Response</label>
 <textarea id="fake-response-text" class="w-full bg-red-50 border border-red-100 rounded-xl p-4 text-sm text-red-900 focus:outline-none focus:border-red-400 focus:ring-2 focus:ring-red-100 h-32 resize-none transition-all" placeholder="Enter the text you want the AI to recite..."></textarea>
 
 <div class="flex justify-end gap-3 mt-6">
 <button onclick="clearResponse()" class="px-4 py-2 text-sm font-medium text-red-500 hover:text-red-700 hover:bg-red-100 rounded-lg transition-colors">Reset</button>
 <button onclick="saveConfig()" class="px-5 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg font-semibold shadow-md shadow-red-200 transition-all">Save Response</button>
 </div>
 </div>
 </div>

 <script>
 // Start animation logic
 window.addEventListener('load', () => {
 const splash = document.getElementById('splash-screen');
 const loadingBar = document.getElementById('loading-bar');
 const mainContent = document.querySelector('main');
 
 // Start loading bar animation
 setTimeout(() => {
 loadingBar.style.width = '100%';
 }, 100);

 // Trigger smooth transition
 setTimeout(() => {
 splash.classList.add('animate-fade-out-up');
 
 // Cascade fade in main content
 setTimeout(() => {
 mainContent.classList.remove('opacity-0');
 mainContent.classList.add('animate-content-fade-in');
 }, 300);

 setTimeout(() => {
 splash.style.display = 'none';
 }, 1200);
 }, 1800);
 });

 // State
 let isTyping = false;
 let isListening = false;
 let recognition;
 
 const defaultResponses = [
 "I have analyzed the quantum vector parameters of your request. While the answer lies within the subspace harmonics, I can confirm that the system is operating at 99.9% efficiency.",
 "Processing... accessing neural substrate. The data indicates a high probability of success, though atmospheric interference is currently limiting full bandwidth connection.",
 "That is an interesting query. According to my internal database of 4.2 petabytes of human history, the optimal response is to simply observe the beauty of the digital void.",
 "I am currently prioritizing higher-level cognitive functions. Please allow me a moment to reallocate processing power from the fusion simulation running in the background."
 ];

 let targetResponse = localStorage.getItem('fakeAiResponse') || "";

 // DOM Elements
 const chatContainer = document.getElementById('chat-container');
 const messagesList = document.getElementById('messages-list');
 const userInput = document.getElementById('user-input');
 const emptyState = document.getElementById('empty-state');
 const configModal = document.getElementById('config-modal');
 const fakeResponseInput = document.getElementById('fake-response-text');
 const micBtn = document.getElementById('mic-btn');

 fakeResponseInput.value = targetResponse;

 // --- Core Text Chat Logic ---

 function handleEnter(e) {
 if (e.key === 'Enter' && !e.shiftKey) {
 e.preventDefault();
 sendMessage();
 }
 }

 function sendMessage() {
 const text = userInput.value.trim();
 if (!text || isTyping) return;

 emptyState.style.display = 'none';
 addMessageToDom('user', text);
 userInput.value = '';
 userInput.style.height = 'auto';
 scrollToBottom();

 isTyping = true;
 
 const aiMsgId = 'ai-' + Date.now();
 const aiContainer = document.createElement('div');
 aiContainer.className = 'flex gap-4 w-full';
 aiContainer.innerHTML = `
 <div class="ai-icon-bg w-8 h-8 rounded-full bg-red-600 flex items-center justify-center flex-shrink-0 mt-1 shadow-md shadow-red-200">
 <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>
 </div>
 <div class="flex-1 space-y-1">
 <div class="ai-text-theme font-bold text-sm text-red-900">Psyche</div>
 <div id="${aiMsgId}" class="markdown-body ai-text-theme typing-cursor"></div>
 </div>
 `;
 messagesList.appendChild(aiContainer);
 scrollToBottom();

 let responseText = targetResponse;
 if (!responseText) {
 responseText = defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
 }

 setTimeout(() => {
 const aiTextElement = document.getElementById(aiMsgId);
 typeText(aiTextElement, responseText);
 }, 800 + Math.random() * 1000);
 }

 function addMessageToDom(role, text) {
 const div = document.createElement('div');
 div.className = 'flex gap-4 w-full justify-end'; 
 div.innerHTML = `
 <div class="flex-1 space-y-1 text-right">
 <div class="ai-text-theme font-bold text-sm text-red-900">You</div>
 <div class="user-bubble-theme inline-block text-left bg-white text-red-900 px-4 py-3 rounded-2xl rounded-tr-sm whitespace-pre-wrap shadow-sm shadow-red-100 border border-red-100">${escapeHtml(text)}</div>
 </div>
 <div class="user-bubble-theme w-8 h-8 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0 mt-1 border border-red-200">
 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-red-500"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
 </div>
 `;
 messagesList.appendChild(div);
 }

 function typeText(element, fullText) {
 let index = 0;
 const typeChar = () => {
 if (index < fullText.length) {
 element.textContent += fullText.charAt(index);
 index++;
 scrollToBottom();
 setTimeout(typeChar, 20 + Math.random() * 30); 
 } else {
 isTyping = false;
 element.classList.remove('typing-cursor');
 }
 };
 typeChar();
 }

 function scrollToBottom() {
 chatContainer.scrollTop = chatContainer.scrollHeight;
 }

 function escapeHtml(text) {
 const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
 return text.replace(/[&<>"']/g, function(m) { return map[m]; });
 }

 // --- Voice Dictation (Web Speech API) ---

 function toggleDictation() {
 if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
 alert("Your browser does not support voice dictation.");
 return;
 }

 if (isListening) {
 stopDictation();
 } else {
 startDictation();
 }
 }

 function startDictation() {
 const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
 recognition = new SpeechRecognition();
 recognition.lang = 'en-US';
 recognition.interimResults = false;
 recognition.maxAlternatives = 1;

 recognition.start();
 isListening = true;
 micBtn.classList.add('listening');

 recognition.onresult = (event) => {
 const speechResult = event.results[0][0].transcript;
 userInput.value += (userInput.value.length > 0 ? ' ' : '') + speechResult;
 userInput.style.height = userInput.scrollHeight + 'px';
 stopDictation();
 };
 recognition.onspeechend = () => stopDictation();
 recognition.onerror = () => stopDictation();
 }

 function stopDictation() {
 if (recognition) recognition.stop();
 isListening = false;
 micBtn.classList.remove('listening');
 }

 // --- Voice Mode Fake Overlay Logic ---
 
 const voiceScreen = document.getElementById('voice-mode-screen');
 const voiceStatus = document.getElementById('voice-status');
 const mainOrb = document.getElementById('main-orb');

 function toggleVoiceMode() {
 if (voiceScreen.classList.contains('hidden')) {
 voiceScreen.classList.remove('hidden');
 voiceScreen.style.opacity = '0';
 setTimeout(() => voiceScreen.style.opacity = '1', 10);
 setVoiceState('listening'); // Default to listening
 } else {
 voiceScreen.style.opacity = '0';
 setTimeout(() => voiceScreen.classList.add('hidden'), 500);
 }
 }

 function setVoiceState(state) {
 // Reset classes
 mainOrb.classList.remove('state-listening', 'state-thinking', 'state-speaking');
 
 if (state === 'listening') {
 voiceStatus.innerText = "Listening...";
 mainOrb.classList.add('state-listening');
 } else if (state === 'thinking') {
 voiceStatus.innerText = "Thinking...";
 mainOrb.classList.add('state-thinking');
 } else if (state === 'speaking') {
 voiceStatus.innerText = "Psyche is speaking...";
 mainOrb.classList.add('state-speaking');
 }
 }

 // --- Dark Theme Toggle ---
 function toggleTheme() {
 document.body.classList.toggle('theme-dark');
 }

 // --- Configuration Modal Logic ---

 function toggleConfigModal() {
 if (configModal.classList.contains('hidden')) {
 configModal.classList.remove('hidden');
 fakeResponseInput.value = targetResponse;
 } else {
 configModal.classList.add('hidden');
 }
 }

 function saveConfig() {
 targetResponse = fakeResponseInput.value;
 localStorage.setItem('fakeAiResponse', targetResponse);
 toggleConfigModal();
 }

 function clearResponse() {
 fakeResponseInput.value = "";
 targetResponse = "";
 localStorage.removeItem('fakeAiResponse');
 }

 configModal.addEventListener('click', (e) => {
 if (e.target === configModal) toggleConfigModal();
 });

 </script>
</body>
</html>
